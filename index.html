<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†—É–ª–µ—Ç–∫–∞ –∏–º–±–æ–≤—ã—Ö –Ω–∏–∫–æ–≤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #0f0f14;
  color: #fff;
  font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.app {
  width: 360px;
  text-align: center;
}

.wheel-wrap {
  position: relative;
  width: 260px;
  height: 260px;
  margin: 20px auto;
}

.wheel {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: conic-gradient(
    #ff4d6d 0deg 60deg,
    #fca311 60deg 120deg,
    #2ec4b6 120deg 180deg,
    #6a4c93 180deg 240deg,
    #ffbe0b 240deg 300deg,
    #ff4d6d 300deg 360deg
  );
  transition: transform 4s cubic-bezier(.17,.67,.12,.99);
}

.pointer {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-bottom: 20px solid red;
}

button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border: none;
  border-radius: 14px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
}

.spin {
  background: #ff4d6d;
  color: #fff;
}

.send {
  background: #229ED9;
  color: #fff;
  display: none;
}

.result {
  font-size: 20px;
  margin-top: 15px;
  min-height: 28px;
}

.error {
  color: #ff6b6b;
  font-size: 14px;
  margin-top: 8px;
}
</style>
</head>

<body>
<div class="app">
  <h2>üé° –†–£–õ–ï–¢–ö–ê –ù–ò–ö–û–í</h2>

  <div class="wheel-wrap">
    <div class="pointer"></div>
    <div id="wheel" class="wheel"></div>
  </div>

  <div id="result" class="result">‚Äî</div>
  <div id="error" class="error"></div>

  <button class="spin" id="spin">üé∞ –ö–†–£–¢–ò–¢–¨</button>
  <button class="send" id="send">üì§ –û–¢–ü–†–ê–í–ò–¢–¨ –í TG</button>
</div>

<script>
const nicks = [
  "–∞–Ω–∞–ª–∏—Ç–µ–∫ —Ç–∏—Ç–µ–∫",
  "–ø–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä –æ–ª–µ–≥–∞ 3000",
  "–¥–∏–≤–∞–Ω —Å —Ñ–µ–µ—á–∫–æ–π –≤–∏–Ω–∫—Å",
  "—à–∞–º–∞–Ω –≤–∞–π—Ñ–∞—è",
  "–¥–∏–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç —É–ª—å—Ç—Ä–∞",
  "–±–∞—Ç—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"
];

const wheel = document.getElementById("wheel");
const result = document.getElementById("result");
const sendBtn = document.getElementById("send");
const errorBox = document.getElementById("error");

let angle = 0;
let currentNick = "";

document.getElementById("spin").onclick = () => {
  errorBox.textContent = "";
  sendBtn.style.display = "none";
  sendBtn.disabled = false;
  sendBtn.textContent = "üì§ –û–¢–ü–†–ê–í–ò–¢–¨ –í TG";

  const index = Math.floor(Math.random() * nicks.length);
  currentNick = nicks[index];

  const sector = 360 / nicks.length;
  const target = 360 * 5 + index * sector + sector / 2;

  angle += target;
  wheel.style.transform = `rotate(${angle}deg)`;

  setTimeout(() => {
    result.textContent = currentNick;
    sendBtn.style.display = "block";
  }, 4000);
};

sendBtn.onclick = async () => {
  if (!currentNick) return;

  sendBtn.disabled = true;
  sendBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";

  try {
    const res = await fetch("/api/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: "üé∞ –í—ã–ø–∞–ª –Ω–∏–∫:\n" + currentNick
      })
    });

    const data = await res.json();

    if (!data.ok) {
      throw new Error(data.description || "TG error");
    }

    sendBtn.onclick = async () => {
  if (!currentNick) {
    errorBox.textContent = "‚ùå –°–Ω–∞—á–∞–ª–∞ –∫—Ä—É—Ç–∞–Ω–∏—Ç–µ —Ä—É–ª–µ—Ç–∫—É";
    return;
  }

  sendBtn.disabled = true;
  sendBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";

  try {
    const res = await fetch("/api/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nick: currentNick })
    });

    const data = await res.json();

    if (!data.ok) throw new Error(JSON.stringify(data));

    sendBtn.textContent = "‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ";
  } catch (e) {
    errorBox.textContent = "‚ùå TG –ù–ï –†–ê–ë–û–¢–ê–ï–¢: " + e.message;
    sendBtn.textContent = "üì§ –û–¢–ü–†–ê–í–ò–¢–¨ –í TG";
    sendBtn.disabled = false;
  }
};

};
</script>
</body>
</html>


